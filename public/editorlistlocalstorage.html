<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/editmode.css" />
    <title>Editmode</title>
</head>

<body>
    <p class="logo">List it</p>

    <div class="list">
        <button class="menyBtn editor" id="saveBtn">Save list</button>
        <button class="menyBtn" id="deleteBtn">Delete list</button>
        <br>
        <div id="title" class="listTitle">List title</div>
        <br>
        <input class="input" type="text" id="titleInp" placeholder="Title">
        <button id="titleBtn" class="underMeny">change title</button>
        <br>
        <input class="input" type="text" id="inpItem" placeholder="item">
        <button id="addBtn" class="underMeny">add to list</button>
        <br><br>
        <div id="container"></div>
    </div>
</body>

<script>

    let url = "http://localhost:3000/editor";

    let inpTitle = document.getElementById("titleInp");
    let inpItem = document.getElementById("inpItem");
    let saveBtn = document.getElementById("saveBtn");
    let titleBtn = document.getElementById("titleBtn");

    let titleDiv = document.getElementById("title");

    let addBtn = document.getElementById("addBtn");
    let container = document.getElementById("container");

    let listID = sessionStorage.getItem('listId');

    let itemList;

    if (localStorage.getItem("list") === null) {
        itemList = new Array;
        console.log("in itemlist = new array")
    } else {
        itemList = JSON.parse(localStorage.getItem("list"));
        console.log(itemList);
    };

    loadList();

    async function loadList() {
        container.innerHTML = "";

        for (let item of itemList) {
            let listDiv = document.createElement("div");
            listDiv.classList.add("listDiv");

            let checkBox = document.createElement("input");
            checkBox.type = "checkbox";
            checkBox.classList.add("checkBox");

            let listItem = document.createElement("span");
            listItem.classList.add("listItem");
            listItem.innerHTML = item;

            let deleteBtn = document.createElement("button");
            deleteBtn.textContent = "Delete";
            deleteBtn.classList.add("listBtn");
            deleteBtn.addEventListener('click', function (evt) {
                deleteItem()
            });

            let editBtn = document.createElement("button");
            editBtn.textContent = "Edit";
            editBtn.classList.add("listBtn");
            editBtn.addEventListener('click', function (evt) {
                editItem()
            });
            listDiv.appendChild(checkBox);
            listDiv.appendChild(listItem);
            listDiv.appendChild(deleteBtn);
            listDiv.appendChild(editBtn);

            container.appendChild(listDiv);
        }
    };
    
    titleBtn.addEventListener('click', function (evt) {
        titleDiv.textContent = inpTitle.value;
        titleValue = titleDiv.innerHTML;
    });


    addBtn.addEventListener("click", function () {

        console.log("in add btn");

        let inpValue = inpItem.value;
        itemList.push(inpValue);

        console.log(itemList);
        localStorage.setItem("list", JSON.stringify(itemList));
        inpItem.value = " ";
        loadList();
    });

    saveBtn.addEventListener('click', async function (evt) {

        let url = "http://localhost:3000/editor";

        let updata = {
            title: titleValue,
            list: itemList,
            userid: 2
        }

        let cfg = {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updata)
        }

        try {
            var resp = await fetch(url, cfg);
            var data = await resp.json();
            console.log(data);
        }
        catch (err) {
            console.log(err);
        }
    });






    async function deleteItem(id) {

        localStorage.removeItem("list");

        let updata = { listItem: id }
        let cfg = {
            methode: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updata)
        }

        try {
            await fetch(url, cfg);
            listItems();
        } catch (err) {
            console.log(err);
        }
    };



</script>

</html>